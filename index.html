<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tracker</title>
    <style>
        :root { --theme-color: #ff8c00; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin:0; background:#1e1e1e; color:#f0f0f0; padding:20px; display:flex; justify-content:center; align-items:flex-start; min-height:100vh; }
        .container { width:100%; max-width:1500px; background:#282828; padding:20px; border-radius:12px; box-shadow:0 10px 20px rgba(0,0,0,0.5); }
        h1,h2,h3 { color:var(--theme-color); border-bottom:2px solid #3d3d3d; padding-bottom:5px; }
        button { padding:10px 15px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; transition:0.2s; background:var(--theme-color); color:#1e1e1e; }
        button:hover { opacity:0.9; transform:translateY(-1px); }
        .tracker-list { list-style:none; padding:0; }
        .tracker-item { background:#444; padding:15px; margin-bottom:10px; border-radius:8px; border-left:5px solid var(--theme-color); display:flex; flex-direction:column; gap:10px; }
        .item-details span { display:block; font-size:0.9em; color:#aaa; }
        .title-edit-input,.link-edit-input,.episodes-edit-input { padding:5px; border:1px solid var(--theme-color); border-radius:4px; background:#333; color:#f0f0f0; display:none; }
        .notes-textarea { width:100%; min-height:80px; padding:8px; border:1px solid #555; border-radius:4px; background:#333; color:#f0f0f0; resize:vertical; display:none; }
        .item-controls { display:flex; gap:10px; flex-wrap:wrap; }
        .save-button { background:#28a745; color:#fff; }
        .cancel-button { background:#6c757d; color:#fff; }
        .delete-button { background:#dc3545; color:#fff; }
    </style>
</head>
<body>
    <div id="main-app-content" class="container">
        <h1>üé¨ Tracker</h1>
        <h3>N√©zend≈ë List√°nk</h3>
        <ul id="nezendo-lista" class="tracker-list"></ul>
    </div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import { getFirestore, collection, onSnapshot, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyAKEKZzgKSTFQ3_K6Yhm7aPvTX5plMzXYg",
    authDomain: "tracker-fbe21.firebaseapp.com",
    projectId: "tracker-fbe21",
    storageBucket: "tracker-fbe21.firebasestorage.app",
    messagingSenderId: "402979419538",
    appId: "1:402979419538:web:ff7924c73c306ff8527d4b"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const SHARED_UID = "SHARED_FRIENDS_GROUP";
const MEDIA_COLLECTION_NAME = 'media';
let trackerList = [];

function getMediaCollectionRef() {
    return collection(db, 'users', SHARED_UID, MEDIA_COLLECTION_NAME);
}

signInAnonymously(auth).then(() => {
    onSnapshot(getMediaCollectionRef(), (snapshot) => {
        trackerList = snapshot.docs.map(doc => ({ firestoreId: doc.id, ...doc.data() }));
        renderLists();
    });
});

function renderLists() {
    const ul = document.getElementById('nezendo-lista');
    ul.innerHTML = '';
    trackerList.forEach(item => {
        const li = document.createElement('li');
        li.className = 'tracker-item';
        li.innerHTML = `
            <div class="item-details">
                <span id="title-display-${item.firestoreId}">${item.cim}</span>
                <input id="title-edit-${item.firestoreId}" class="title-edit-input" value="${item.cim}">
                ${item.link ? `<span id="link-display-${item.firestoreId}">üîó ${item.link}</span>`:''}
                <input id="link-edit-${item.firestoreId}" class="link-edit-input" value="${item.link||''}">
                ${item.tipus==='sorozat' ? `<span id="episodes-display-${item.firestoreId}">Epiz√≥dok: ${item.maxEpisodes||0}</span>`:''}
                ${item.tipus==='sorozat' ? `<input id="episodes-edit-${item.firestoreId}" class="episodes-edit-input" value="${item.maxEpisodes||0}">`:''}
                <span id="notes-display-${item.firestoreId}">${item.notes||''}</span>
                <textarea id="notes-edit-${item.firestoreId}" class="notes-textarea">${item.notes||''}</textarea>
            </div>
            <div class="item-controls">
                <button id="edit-btn-${item.firestoreId}" onclick="toggleEditMode('${item.firestoreId}')">‚úèÔ∏è Szerkeszt√©s</button>
                <button id="save-btn-${item.firestoreId}" class="save-button" style="display:none;" onclick="saveItemDetails('${item.firestoreId}')">üíæ Ment√©s</button>
                <button id="cancel-btn-${item.firestoreId}" class="cancel-button" style="display:none;" onclick="toggleEditMode('${item.firestoreId}')">‚ùå M√©gse</button>
                <button class="delete-button" onclick="deleteItem('${item.firestoreId}')">üóëÔ∏è T√∂rl√©s</button>
            </div>
        `;
        ul.appendChild(li);
    });
}

window.toggleEditMode = function(firestoreId) {
    const titleDisplay = document.getElementById(`title-display-${firestoreId}`);
    const titleInput = document.getElementById(`title-edit-${firestoreId}`);
    const linkDisplay = document.getElementById(`link-display-${firestoreId}`);
    const linkInput = document.getElementById(`link-edit-${firestoreId}`);
    const episodesDisplay = document.getElementById(`episodes-display-${firestoreId}`);
    const episodesInput = document.getElementById(`episodes-edit-${firestoreId}`);
    const notesDisplay = document.getElementById(`notes-display-${firestoreId}`);
    const notesInput = document.getElementById(`notes-edit-${firestoreId}`);
    const editBtn = document.getElementById(`edit-btn-${firestoreId}`);
    const saveBtn = document.getElementById(`save-btn-${firestoreId}`);
    const cancelBtn = document.getElementById(`cancel-btn-${firestoreId}`);

    const isEditing = titleInput.style.display !== 'none';
    if (!isEditing) {
        if(titleDisplay) titleDisplay.style.display='none';
        if(titleInput) titleInput.style.display='inline-block';
        if(linkDisplay) linkDisplay.style.display='none';
        if(linkInput) linkInput.style.display='inline-block';
        if(episodesDisplay) episodesDisplay.style.display='none';
        if(episodesInput) episodesInput.style.display='inline-block';
        if(notesDisplay) notesDisplay.style.display='none';
        if(notesInput) notesInput.style.display='block';
        editBtn.style.display='none'; saveBtn.style.display='inline-block'; cancelBtn.style.display='inline-block';
    } else {
        if(titleDisplay) titleDisplay.style.display='block';
        if(titleInput) titleInput.style.display='none';
        if(linkDisplay) linkDisplay.style.display='block';
        if(linkInput) linkInput.style.display='none';
        if(episodesDisplay) episodesDisplay.style.display='block';
        if(episodesInput) episodesInput.style.display='none';
        if(notesDisplay) notesDisplay.style.display='block';
        if(notesInput) notesInput.style.display='none';
        editBtn.style.display='inline-block'; saveBtn.style.display='none'; cancelBtn.style.display='none';
    }
}

window.saveItemDetails = async function(firestoreId) {
    const titleInput = document.getElementById(`title-edit-${firestoreId}`);
    const linkInput = document.getElementById(`link-edit-${firestoreId
